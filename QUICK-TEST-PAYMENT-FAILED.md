# å¿«é€Ÿæ¸¬è©¦æŒ‡å— - Debug é é¢ä»˜æ¬¾å¤±æ•—åŠŸèƒ½

## ğŸ“ æ¸¬è©¦ä½ç½®
```
http://localhost:3000/zh-TW/debug
```

## âš¡ å¿«é€Ÿé–‹å§‹

### 1ï¸âƒ£ å‰ç½®æº–å‚™ï¼ˆ3 å€‹ Terminalï¼‰

```bash
# Terminal 1: Stripe Webhook
stripe listen --forward-to http://localhost:8000/api/stripe/webhook

# Terminal 2: Backend
cd apps/backend && npm run start:dev

# Terminal 3: Frontend  
cd apps/frontend && npm run dev
```

### 2ï¸âƒ£ æ‰¾åˆ°æ¸¬è©¦å€å¡Š
åœ¨ Debug é é¢å¾€ä¸‹æ»¾å‹•ï¼Œæ‰¾åˆ°ï¼š
```
æ­¥é©Ÿ 3-5 - ä»˜æ¬¾å¤±æ•—æ¸¬è©¦
```

### 3ï¸âƒ£ ä¸‰å€‹æ¸¬è©¦æŒ‰éˆ•

| æŒ‰éˆ• | åŠŸèƒ½ | éœ€è¦æ¢ä»¶ |
|------|------|----------|
| âš ï¸ è§¸ç™¼ä»˜æ¬¾å¤±æ•— | æç¤ºåŸ·è¡Œ stripe trigger | éœ€è¦ active è¨‚é–± |
| ğŸ“‹ æŸ¥çœ‹ä»˜æ¬¾å¤±æ•—è³‡è¨Š | èª¿ç”¨ API æŸ¥çœ‹ç‹€æ…‹ | ç„¡ |
| ğŸ“„ æŸ¥çœ‹å¤±æ•—ç™¼ç¥¨åˆ—è¡¨ | èª¿ç”¨ API æŸ¥çœ‹ç™¼ç¥¨ | ç„¡ |

### 4ï¸âƒ£ æ¸¬è©¦æµç¨‹ï¼ˆ5 åˆ†é˜ï¼‰

1. **å»ºç«‹è¨‚é–±**ï¼ˆæ­¥é©Ÿ 3-1ï¼‰
   - é»é¸ä»»æ„æ–¹æ¡ˆï¼ˆå¦‚ Starterï¼‰
   - ç­‰å¾…è¨‚é–±å»ºç«‹å®Œæˆ

2. **è§¸ç™¼å¤±æ•—**
   - é»æ“Šã€Œâš ï¸ è§¸ç™¼ä»˜æ¬¾å¤±æ•—ã€
   - åœ¨ Terminal åŸ·è¡Œæç¤ºçš„å‘½ä»¤ï¼š
     ```bash
     stripe trigger invoice.payment_failed
     ```

3. **æŸ¥çœ‹çµæœ**
   - é»æ“Šã€ŒğŸ“‹ æŸ¥çœ‹ä»˜æ¬¾å¤±æ•—è³‡è¨Šã€
   - æª¢æŸ¥ Process Log å’Œ Alert

4. **æŸ¥çœ‹ç™¼ç¥¨**
   - é»æ“Šã€ŒğŸ“„ æŸ¥çœ‹å¤±æ•—ç™¼ç¥¨åˆ—è¡¨ã€
   - æª¢æŸ¥æ‰€æœ‰å¤±æ•—ç™¼ç¥¨

5. **é©—è­‰è³‡æ–™**
   - å‘ä¸‹æ»¾å‹•åˆ°ã€ŒPaymentsã€å€å¡Š
   - çœ‹åˆ°ç´…è‰²çš„ `failed` æ¨™ç±¤ âœ“

6. **æª¢æŸ¥ Dashboard**
   - å‰å¾€ `/zh-TW/dashboard`
   - çœ‹åˆ°é»ƒè‰²è­¦å‘Šæ©«å¹… âœ“

## ğŸ¨ è¦–è¦ºæŒ‡å¼•

### Payment ç‹€æ…‹é¡è‰²
- ğŸŸ¢ `succeeded` - ç¶ è‰²
- ğŸ”´ `failed` - ç´…è‰²  
- ğŸŸ¡ `pending` - é»ƒè‰²

### Process Log ç¯„ä¾‹
```
14:30:45: ğŸ“‹ é–‹å§‹æŸ¥è©¢ä»˜æ¬¾å¤±æ•—è³‡è¨Š
14:30:45: ğŸ“¡ èª¿ç”¨ API: http://localhost:8000/api/stripe/payment-failed-info
14:30:45: ğŸ“¥ æ”¶åˆ°å›æ‡‰: 200 OK
14:30:45: âœ“ hasFailedPayment: true
14:30:45: âœ“ subscriptionStatus: past_due
14:30:45: âœ“ failedInvoices: 1 ç­†
```

## âš ï¸ å¸¸è¦‹å•é¡Œ

### Q: æŒ‰éˆ•æ˜¯ç°è‰²çš„ï¼ˆdisabledï¼‰ï¼Ÿ
A: éœ€è¦å…ˆå»ºç«‹ active è¨‚é–±ï¼ˆåŸ·è¡Œæ­¥é©Ÿ 3-1ï¼‰

### Q: API å›æ‡‰ 401 éŒ¯èª¤ï¼Ÿ
A: é‡æ–°ç™»å…¥æˆ–åˆ·æ–°é é¢

### Q: Stripe CLI æ²’æœ‰æ”¶åˆ° webhookï¼Ÿ
A: ç¢ºèª `stripe listen` æ­£åœ¨é‹è¡Œä¸”ç«¯é»æ­£ç¢º

### Q: æ²’çœ‹åˆ° failed paymentï¼Ÿ
A: é»æ“Šé é¢é ‚éƒ¨çš„ã€ŒğŸ”„ é‡æ–°è¼‰å…¥ã€æŒ‰éˆ•

## ğŸ“„ å®Œæ•´æ–‡ä»¶
è©³è¦‹ï¼š`DEBUG-PAYMENT-FAILED-TEST.md`
