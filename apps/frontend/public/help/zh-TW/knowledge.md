# 問答功能說明

## 概述

問答功能讓您可以完整管理 Chatbot 的知識庫，包括建立、編輯、分類和批量上傳問答內容。系統提供四個主要功能區塊：問答列表、分類管理、批量上傳和 AI 生成卡片。所有問答內容會自動儲存，並可即時在 Chatbot 中使用。

## 功能區塊

### 1. 問答列表

問答列表是管理所有問答內容的主要區域，提供完整的 CRUD 功能和強大的搜尋篩選功能。

#### 基本操作

- **新增問答**：點擊右上角「+ 新增」按鈕，開啟問答編輯器
- **編輯問答**：點擊問答項目右側的「編輯」按鈕，開啟編輯器
- **刪除問答**：點擊問答項目右側的「刪除」按鈕，系統會要求確認後執行
- **查看詳情**：點擊問答項目可查看完整內容

#### 搜尋與篩選

- **搜尋功能**：在搜尋框輸入關鍵字，可即時搜尋問題或答案內容
- **分類篩選**：使用分類下拉選單，選擇特定分類或「未分類」
- **狀態篩選**：使用統計按鈕快速篩選
  - **問答**：顯示所有問答
  - **啟用**：只顯示啟用狀態的問答
  - **停用**：只顯示停用狀態的問答
  - **未分類**：只顯示未分類的問答

#### 批量操作

選擇多個問答後，可以進行批量操作：

- **批量設定分類**：為選中的問答設定分類
- **批量啟用**：將選中的問答設為啟用狀態
- **批量停用**：將選中的問答設為停用狀態
- **批量刪除**：刪除選中的所有問答

**使用方式：**
1. 勾選問答項目左側的核取方塊
2. 選擇多個問答後，上方會顯示批量操作工具列
3. 選擇要執行的操作
4. 系統會要求確認後執行

#### 問答編輯器

問答編輯器提供完整的編輯功能，支援 Markdown 格式和 AI 優化功能。

**必填欄位**
- **問題**：問答的問題標題
- **答案**：問答的答案內容（支援 Markdown 格式）

**選填欄位**
- **同義詞**：輸入多個同義詞，用逗號分隔（例如：FAQ, 常見問題, 問與答）
- **分類**：選擇問答所屬的分類
- **狀態**：設定問答為「啟用」或「停用」，使用右上角的切換開關

**Markdown 支援**
- 答案欄位支援完整的 Markdown 格式
- 可以使用標題、列表、粗體、斜體、連結、表格等格式
- 支援圖片上傳（JPG, PNG, GIF, WEBP，最大 5MB）
- 編輯器提供 WYSIWYG 和 Markdown 兩種編輯模式

**AI 優化功能**
- 點擊答案編輯器右上角的「AI」按鈕，可以自動優化答案格式
- AI 會優化答案的結構和格式，使其更符合 QA 呈現
- 優化後會自動更新到編輯器中，只更新答案內容，不影響問題
- 優化過程中按鈕會顯示「優化中...」狀態

**編輯器功能**
- **即時預覽**：切換 WYSIWYG 和 Markdown 模式查看效果
- **圖片上傳**：支援拖曳或點擊上傳圖片
- **格式化工具**：提供標題、粗體、斜體、列表、表格、連結等工具
- **自動儲存**：編輯完成後點擊「儲存」按鈕儲存變更

---

### 2. 分類管理

分類管理讓您可以建立階層式的分類結構，方便組織和管理問答內容。

#### 基本操作

- **新增分類**：點擊右上角「+ 新增分類」按鈕
- **編輯分類**：點擊分類項目右側的「編輯」按鈕
- **刪除分類**：點擊分類項目右側的「刪除」按鈕
  - 如果分類下有問答，系統會提示無法刪除
  - 如果分類下有子分類，需要先刪除子分類

#### 階層結構

- **父分類**：可以建立頂層分類
- **子分類**：可以為分類建立子分類，形成多層階層結構
- **展開/收起**：點擊分類項目可以展開或收起子分類
- **視覺化顯示**：階層結構以縮排方式顯示，方便識別

#### 排序功能

- **上移/下移**：使用分類項目右側的上下箭頭按鈕調整順序
- 排序會影響問答列表中的分類顯示順序
- 子分類的排序獨立於父分類

#### 分類表單

建立或編輯分類時，可以設定：

- **分類名稱**：必填，分類的顯示名稱
- **父分類**：選擇此分類的上層分類（可選）
- **描述**：分類的說明文字（可選）

---

### 3. 批量上傳

批量上傳功能讓您可以透過 CSV 或 XLSX 檔案一次匯入多筆問答內容，大幅提升資料建立效率。

#### 支援格式

- **CSV**：逗號分隔值檔案
- **XLSX**：Excel 2007+ 格式

#### 使用步驟

1. **選擇檔案**
   - 點擊「選擇檔案」或拖曳檔案到上傳區域
   - 系統會自動解析檔案內容
   - 支援檔案大小限制檢查

2. **欄位對應**
   - 系統會自動偵測欄位名稱
   - 手動對應欄位到系統欄位：
     - **問題**（必填）：對應到問題欄位
     - **答案**（必填）：對應到答案欄位
     - **同義詞**（選填）：對應到同義詞欄位
     - **分類名稱**（選填）：對應到分類欄位
   - 不需要的欄位可以選擇「忽略此欄位」

3. **資料預覽**
   - 檢查解析後的資料是否正確
   - 查看驗證錯誤（如有）
   - 修正錯誤後重新上傳
   - 顯示成功、跳過、失敗的項目統計

4. **執行上傳**
   - 點擊「上傳」按鈕開始批量上傳
   - 系統會顯示上傳進度和結果
   - 上傳完成後可以查看詳細結果

#### 欄位對應規則

系統會自動識別以下欄位名稱（不區分大小寫）：

**問題欄位**
- question, 問題, 問, q, q:

**答案欄位**
- answer, 答案, 回答, ans, a, a:, 答案：, 回答：

**同義詞欄位**
- synonym, 同義詞, 別名, 同義問法, synonyms, 別名：, 同義詞：, 標籤, tag, tags, 標籤：

**分類欄位**
- topic_name, topic, 分類, category, 類別

#### 資料驗證

上傳前系統會進行以下驗證：

- **必填欄位檢查**：問題和答案必須填寫
- **資料格式檢查**：確保資料格式正確
- **分類檢查**：如果指定分類名稱，系統會自動建立不存在的分類
- **重複檢查**：檢查是否有重複的問答

#### 上傳結果

上傳完成後會顯示：

- **成功數量**：成功新增的問答數量
- **跳過數量**：因為重複或其他原因跳過的數量
- **失敗數量**：上傳失敗的問答數量
- **詳細資訊**：可以查看每個問答的上傳狀態和錯誤訊息

---

### 4. 排序管理

排序管理功能讓您可以透過拖曳方式調整問答的顯示順序，讓重要的問答優先顯示在 Chatbot 中。

#### 基本功能

- **視覺化排序**：以清單方式顯示所有分類和問答，清楚呈現層級關係
- **拖曳排序**：直接拖曳問答項目調整順序，系統自動儲存
- **即時更新**：排序後立即生效，無需手動儲存

#### 使用方式

1. **進入排序管理**
   - 在問答管理頁面，點擊「排序管理」標籤
   - 系統會顯示所有分類和問答的混合列表

2. **查看結構**
   - **已分類問答區塊**：顯示所有分類及其下的問答
     - **分類**：以藍色背景顯示，字體較大，僅供參考，不可拖曳排序
     - **問答**：以白色背景顯示，向右縮排，顯示屬於上面的分類
   - **未分類問答區塊**：單獨顯示在下方，有清楚的區塊標題和數量標示
     - **未分類問答**：以白色背景顯示，標示為「未分類」，可以互相調整順序

3. **調整順序**
   - 拖曳問答項目左側的圖標（三條橫線）
   - 將問答拖曳到目標位置
   - 系統會自動計算新的排序值並儲存
   - 只會更新受影響的問答，不會更新所有問答

4. **排序規則**
   - 問答會按照所屬分類分組排序
   - 同一分類下的問答可以調整順序
   - 排序值越小，顯示順序越前面

#### 功能限制

- **分類排序**：分類不支援在此處排序，請使用「分類管理」功能調整分類順序
- **跨分類拖曳**：問答不能跨分類拖曳，只能在同一個分類內調整順序
- **跨區塊拖曳**：已分類問答和未分類問答不能互相拖曳，必須先設定分類才能移動
- **未分類問答**：未分類的問答可以互相調整順序，適合不分類當作一般 FAQ 使用的場景

#### 排序邏輯

- 系統會自動計算每個問答的 `sortOrder` 值
- 排序值從 0 開始，依序遞增
- 同一分類內的問答按 `sortOrder` 升序排列
- 如果 `sortOrder` 相同，則按建立時間降序排列

#### 使用建議

1. **優先排序重要問答**：將最常被問到的問答排在前面
2. **按分類組織**：先為問答設定分類，再進行排序
3. **定期調整**：根據使用情況定期調整問答順序
4. **測試效果**：排序後可以在 Chatbot 中測試顯示效果

---

### 5. AI 生成卡片

AI 生成卡片功能讓您可以透過 AI 自動從文章內容生成問答卡片，大幅提升內容建立效率。

#### 基本功能

- **從內容生成**：貼上文章內容，AI 自動分析並生成多張問答卡片
- **從 URL 載入**：輸入網頁 URL，系統自動抓取內容並生成問答卡片
- **從標題生成**：輸入標題和內容，AI 自動生成對應的答案

#### 使用方式

1. **輸入內容**
   - 在文字框中貼上要生成問答的文章內容
   - 或點擊「載入 URL」按鈕，輸入網頁網址

2. **設定參數**
   - 選擇要生成的卡片數量（1-20 張）
   - 系統會根據內容自動分析並生成

3. **生成卡片**
   - 點擊「生成」按鈕開始生成
   - 系統會顯示生成進度
   - 生成完成後會顯示所有卡片草稿

4. **編輯與儲存**
   - 可以編輯每張卡片的問題和答案
   - 點擊「編輯並儲存」將卡片儲存到知識庫
   - 可以刪除不需要的卡片

#### 功能特點

- **智能分析**：AI 自動分析內容，提取關鍵資訊
- **多卡片生成**：一次生成多張相關問答卡片
- **即時預覽**：生成後可以即時預覽卡片內容
- **可編輯**：生成後可以手動調整內容
- **費用顯示**：顯示 AI 生成使用的 Token 數量和費用

---

## 使用建議

### 問答管理

1. **使用分類組織問答**：建議先建立分類結構，再將問答歸類到對應分類
2. **善用同義詞**：為問答設定同義詞，可以提升 AI 搜尋的準確度
3. **定期檢查停用問答**：停用過時或錯誤的問答，避免誤導用戶
4. **使用 Markdown 格式化答案**：讓答案內容更易讀，支援圖片和連結
5. **使用 AI 優化功能**：對於格式不佳的答案，使用 AI 優化功能自動改善格式

### 分類管理

1. **建立階層結構**：使用父子分類建立清晰的知識結構
2. **合理命名**：使用清楚、簡潔的分類名稱
3. **定期整理**：刪除不需要的分類，保持分類結構簡潔
4. **排序管理**：使用分類管理的排序功能將重要分類排在前面

### 排序管理

1. **先分類再排序**：建議先為問答設定分類，再進行排序管理
2. **優先重要問答**：將最常被問到的問答排在前面，提升用戶體驗
3. **定期調整**：根據 Chatbot 的使用數據，定期調整問答順序
4. **測試效果**：排序後在 Chatbot 中測試，確認顯示順序符合預期

### 批量上傳

1. **準備資料**：確保 CSV/XLSX 檔案格式正確，欄位名稱清楚
2. **先預覽再上傳**：上傳前先檢查資料預覽，確認欄位對應正確
3. **分批上傳**：如果資料量很大，建議分批上傳，避免單次上傳過多資料
4. **檢查結果**：上傳後檢查失敗項目，修正後重新上傳
5. **分類規劃**：預先在檔案中規劃好分類，系統會自動建立

### AI 生成卡片

1. **內容準備**：準備結構清晰的文章內容，有助於 AI 生成更好的問答
2. **數量設定**：根據內容長度合理設定生成數量，避免過多或過少
3. **內容檢查**：生成後務必檢查內容準確性，必要時手動調整
4. **分類歸類**：生成後記得為卡片設定適當的分類

---

## 常見問題

### Q: 如何刪除有問答的分類？
A: 需要先將分類下的問答移動到其他分類或設為未分類，才能刪除分類。

### Q: 批量上傳時，如果分類不存在會怎樣？
A: 系統會自動建立不存在的分類。如果分類名稱對應到多個欄位，會使用第一個對應的欄位值。

### Q: 問答的「命中次數」是什麼？
A: 命中次數記錄該問答被用戶查詢到的次數，可以用來了解哪些問答最常被使用。這個數據可以在「分析」功能中查看。

### Q: 支援哪些圖片格式？
A: 支援 JPG, JPEG, PNG, GIF, WEBP 格式，單檔最大 5MB。

### Q: 如何讓問答在 Chatbot 中顯示？
A: 問答必須設為「啟用」狀態，才會在 Chatbot 中顯示。停用的問答不會出現在搜尋結果中。

### Q: 批量上傳失敗怎麼辦？
A: 檢查上傳結果中的錯誤訊息，修正資料後重新上傳。常見錯誤包括：
- 必填欄位缺失
- 資料格式錯誤
- 檔案格式不支援

### Q: AI 優化功能會改變答案的內容嗎？
A: AI 優化功能主要優化答案的格式和結構，不會改變答案的核心內容和原意。優化後會自動更新到編輯器中，您可以檢查後再儲存。

### Q: AI 生成卡片需要費用嗎？
A: 是的，AI 生成卡片會使用 LLM API，會產生費用。系統會顯示使用的 Token 數量和費用資訊。

### Q: 同義詞有什麼作用？
A: 同義詞可以幫助 AI 更準確地匹配用戶的問題。例如，如果問答的問題是「如何申請退款？」，可以設定同義詞「退款流程、退費方式、如何退錢」，這樣用戶用不同的問法也能找到這個問答。

### Q: 排序管理中的分類可以拖曳排序嗎？
A: 不可以。分類的排序請使用「分類管理」功能。排序管理只允許調整問答的順序，分類僅供參考顯示。

### Q: 排序後會影響所有問答嗎？
A: 不會。系統採用優化演算法，只會更新受影響範圍內的問答，不會更新所有問答，提升效能。

### Q: 排序管理中的問答順序如何影響 Chatbot？
A: 排序值越小的問答會優先顯示在 Chatbot 中。當用戶查詢時，系統會按照排序順序返回相關問答。

---

## 技術說明

- 問答資料儲存在資料庫中，並與 Chatbot 綁定
- Markdown 編輯器使用 Toast UI Editor，支援 WYSIWYG 和 Markdown 兩種模式
- 圖片上傳會自動上傳到伺服器，並返回圖片 URL
- AI 優化功能使用 LLM API，需要配置 OPENAI_API_KEY 環境變數
- 批量上傳支援 CSV 和 XLSX 格式，使用 SheetJS 解析
- 分類支援多層階層結構，使用遞迴方式處理
- 搜尋功能支援即時搜尋，使用前端過濾機制
